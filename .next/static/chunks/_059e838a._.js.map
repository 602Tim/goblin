{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/hooks/useMqttClient.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport mqtt from \"mqtt\";\r\n\r\nexport function useMqttClient({\r\n    brokerUrl = process.env.NEXT_PUBLIC_MQTT_URL || \"wss://broker.emqx.io:8084/mqtt\",\r\n    subscribeTopics = [],\r\n    publishTopic = \"\",\r\n    mqttOptions = {},\r\n}) {\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [messages, setMessages] = useState([]);\r\n    const clientRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const clientId = `nextjs-client-${Math.random().toString(16).slice(2, 10)}`;\r\n        const client = mqtt.connect(brokerUrl, {\r\n            clientId,\r\n            clean: true,\r\n            connectTimeout: 4000,\r\n            reconnectPeriod: 1000,\r\n            ...mqttOptions,\r\n        });\r\n\r\n        clientRef.current = client;\r\n\r\n        client.on(\"connect\", () => {\r\n            console.log(`已連接 MQTT Broker: ${brokerUrl}`);\r\n            setIsConnected(true);\r\n\r\n            subscribeTopics.forEach((topic) => {\r\n                client.subscribe(topic, (err) => {\r\n                    if (err) {\r\n                        console.error(`訂閱主題 ${topic} 失敗:`, err);\r\n                    } else {\r\n                        console.log(`已訂閱主題: ${topic}`);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        client.on(\"message\", (topic, payload) => {\r\n            const message = {\r\n                topic,\r\n                payload: payload.toString(),\r\n                timestamp: new Date().toISOString(),\r\n            };\r\n            setMessages((prevMessages) => [...prevMessages, message]);\r\n        });\r\n\r\n        client.on(\"error\", (err) => {\r\n            console.error(\"MQTT Client 錯誤:\", err);\r\n            setIsConnected(false);\r\n        });\r\n\r\n        client.on(\"close\", () => {\r\n            console.warn(\"MQTT Client 連接已關閉\");\r\n            setIsConnected(false);\r\n        });\r\n\r\n        return () => {\r\n            subscribeTopics.forEach((topic) => client.unsubscribe(topic));\r\n            client.end();\r\n        };\r\n    }, [brokerUrl, subscribeTopics.join(\",\")]);\r\n\r\n    const publishMessage = (topic, msg) => {\r\n        const client = clientRef.current;\r\n        if (!topic) topic = publishTopic;\r\n        if (client && isConnected && topic && msg.trim()) {\r\n            client.publish(topic, msg, { qos: 0 }, (err) => {\r\n                if (err) {\r\n                    console.error(`發佈消息到 ${topic} 失敗:`, err);\r\n                } else {\r\n                    console.log(`已發佈消息到 ${topic}`);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return { isConnected, messages, publishMessage };\r\n}\r\n"],"names":[],"mappings":";;;AAKgB;AAJhB;AACA;;AAFA;;;AAIO,SAAS,cAAc,EAC1B,YAAY,sEAAoC,gCAAgC,EAChF,kBAAkB,EAAE,EACpB,eAAe,EAAE,EACjB,cAAc,CAAC,CAAC,EACnB;;IACG,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE,EAAE;IAC3C,MAAM,YAAY,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAE;IAEzB,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;mCAAE;YACN,MAAM,WAAW,CAAC,cAAc,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,KAAK;YAC3E,MAAM,SAAS,8IAAA,CAAA,UAAI,CAAC,OAAO,CAAC,WAAW;gBACnC;gBACA,OAAO;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,GAAG,WAAW;YAClB;YAEA,UAAU,OAAO,GAAG;YAEpB,OAAO,EAAE,CAAC;2CAAW;oBACjB,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,WAAW;oBAC3C,eAAe;oBAEf,gBAAgB,OAAO;mDAAC,CAAC;4BACrB,OAAO,SAAS,CAAC;2DAAO,CAAC;oCACrB,IAAI,KAAK;wCACL,QAAQ,KAAK,CAAC,CAAC,KAAK,EAAE,MAAM,IAAI,CAAC,EAAE;oCACvC,OAAO;wCACH,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,OAAO;oCACjC;gCACJ;;wBACJ;;gBACJ;;YAEA,OAAO,EAAE,CAAC;2CAAW,CAAC,OAAO;oBACzB,MAAM,UAAU;wBACZ;wBACA,SAAS,QAAQ,QAAQ;wBACzB,WAAW,IAAI,OAAO,WAAW;oBACrC;oBACA;mDAAY,CAAC,eAAiB;mCAAI;gCAAc;6BAAQ;;gBAC5D;;YAEA,OAAO,EAAE,CAAC;2CAAS,CAAC;oBAChB,QAAQ,KAAK,CAAC,mBAAmB;oBACjC,eAAe;gBACnB;;YAEA,OAAO,EAAE,CAAC;2CAAS;oBACf,QAAQ,IAAI,CAAC;oBACb,eAAe;gBACnB;;YAEA;2CAAO;oBACH,gBAAgB,OAAO;mDAAC,CAAC,QAAU,OAAO,WAAW,CAAC;;oBACtD,OAAO,GAAG;gBACd;;QACJ;kCAAG;QAAC;QAAW,gBAAgB,IAAI,CAAC;KAAK;IAEzC,MAAM,iBAAiB,CAAC,OAAO;QAC3B,MAAM,SAAS,UAAU,OAAO;QAChC,IAAI,CAAC,OAAO,QAAQ;QACpB,IAAI,UAAU,eAAe,SAAS,IAAI,IAAI,IAAI;YAC9C,OAAO,OAAO,CAAC,OAAO,KAAK;gBAAE,KAAK;YAAE,GAAG,CAAC;gBACpC,IAAI,KAAK;oBACL,QAAQ,KAAK,CAAC,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,EAAE;gBACxC,OAAO;oBACH,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,OAAO;gBACjC;YACJ;QACJ;IACJ;IAEA,OAAO;QAAE;QAAa;QAAU;IAAe;AACnD;GA7EgB","debugId":null}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/actions/notification.js"],"sourcesContent":["// app/actions/notification.js (修正後)\r\n\"use server\"; // ✨ 必須有這行，將其標記為 Server Actions\r\n\r\nimport { prisma } from '@/lib/prisma'; // ✨ 導入具名導出的 prisma 客戶端\r\n\r\nexport const addNotification = async (body, userId) => {\r\n    try {\r\n        // ✨ 這裡應該是添加通知到資料庫的邏輯\r\n        if (!userId || !body || !body.message || !body.orderId || !body.title || !body.type) {\r\n            throw new Error(\"Missing notification data or userId.\");\r\n        }\r\n        const newNotification = await prisma.notification.create({\r\n            data: {\r\n                userId: userId,\r\n                orderId: body.orderId, // 假設 body 包含 orderId\r\n                message: body.message,\r\n                // 其他欄位如 isRead 會有 default 值\r\n                // title 和 type 需要在你的 Notification model 中定義或處理\r\n            }\r\n        });\r\n        return { success: true, notification: newNotification };\r\n    } catch (error) {\r\n        console.error(\"Failed to add notification (Server Action):\", error);\r\n        return { error: error.message };\r\n    }\r\n};\r\n\r\nexport const getUserNotification = async (userId) => {\r\n    try {\r\n        // ✨ 這裡應該是從資料庫獲取使用者通知的邏輯\r\n        if (!userId) {\r\n            throw new Error(\"User ID is required for fetching notifications.\");\r\n        }\r\n        const notifications = await prisma.notification.findMany({\r\n            where: { userId: userId },\r\n            orderBy: { createdAt: 'desc' }, // 按最新排序\r\n        });\r\n        return notifications;\r\n    } catch (error) {\r\n        console.error(\"Failed to get user notifications (Server Action):\", error);\r\n        return { error: error.message }; // 返回錯誤訊息，以便前端處理\r\n    }\r\n};\r\n\r\nexport const deleteNotification = async (notificationId) => {\r\n    try {\r\n        // ✨ 這裡應該是從資料庫刪除通知的邏輯\r\n        if (!notificationId) {\r\n            throw new Error(\"Notification ID is required for deleting.\");\r\n        }\r\n        await prisma.notification.delete({\r\n            where: { id: notificationId },\r\n        });\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Failed to delete notification (Server Action):\", error);\r\n        // 如果是找不到通知的錯誤，可以更精確地處理\r\n        if (error.code === 'P2025') {\r\n            return { error: \"Notification not found.\" };\r\n        }\r\n        return { error: error.message };\r\n    }\r\n};"],"names":[],"mappings":";;;;;;IA2Ba,sBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/utils/mqttTopic.ts"],"sourcesContent":["const TOPIC_ROOT = process.env.NEXT_PUBLIC_MQTT_TOPIC_ROOT;\r\n\r\nconst getTopicRoot = () => {\r\n    if (!TOPIC_ROOT) {\r\n        throw new Error(\"未填寫 .env 的 NEXT_PUBLIC_MQTT_TOPIC_ROOT\");\r\n    }\r\n    return `nuu/shisa/${TOPIC_ROOT}`;\r\n};\r\n\r\nexport const getOrderCheckoutTopic = () => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/checkout`;\r\n};\r\nexport const getAcceptCustomerOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/accept/${customerId}`;\r\n};\r\nexport const getKitchenOrderTopic = () => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/kitchen`;\r\n};\r\nexport const getKitchenReadyOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/ready/${customerId}`;\r\n};\r\nexport const getStaffCompletedOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/completed/${customerId}`;\r\n};\r\nexport const getCustomerCancelOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/cancel/${customerId}`;\r\n};\r\n\r\nexport const getOrderStatusWildcardTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/+/${customerId}`;\r\n}\r\nexport function getOrderToKitchenTopic() {\r\n  return `nuu/shisa/orders/to-kitchen`;\r\n}\r\n\r\nexport function getNotificationTopicByUserId(userId: string) {\r\n  return `nuu/shisa/notifications/${userId}`;\r\n}\r\nexport function getCustomerOrderUpdateTopic(customerId: string) {\r\n  return `nuu/shisa/customer/${customerId}/orders/updated`;\r\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAmB;AAAnB,MAAM;AAEN,MAAM,eAAe;IACjB,uCAAiB;;IAEjB;IACA,OAAO,CAAC,UAAU,EAAE,YAAY;AACpC;AAEO,MAAM,wBAAwB;IACjC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,sBAAsB,CAAC;AAC/C;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,EAAE,YAAY;AAC3D;AACO,MAAM,uBAAuB;IAChC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,CAAC;AAC9C;AACO,MAAM,4BAA4B,CAAC;IACtC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,oBAAoB,EAAE,YAAY;AAC1D;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,wBAAwB,EAAE,YAAY;AAC9D;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,EAAE,YAAY;AAC3D;AAEO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,gBAAgB,EAAE,YAAY;AACtD;AACO,SAAS;IACd,OAAO,CAAC,2BAA2B,CAAC;AACtC;AAEO,SAAS,6BAA6B,MAAc;IACzD,OAAO,CAAC,wBAAwB,EAAE,QAAQ;AAC5C;AACO,SAAS,4BAA4B,UAAkB;IAC5D,OAAO,CAAC,mBAAmB,EAAE,WAAW,eAAe,CAAC;AAC1D","debugId":null}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/hooks/useNotifications.js"],"sourcesContent":["// hooks/useNotifications.js\r\n\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\"; // ✨ 新增 useCallback\r\n// ✨ 移除這行：import useUser from \"./useUser\"; // 不再需要 useUser hook\r\nimport { useMqttClient } from \"@/hooks/useMqttClient\";\r\nimport { getUserNotification } from \"@/app/actions/notification\";\r\nimport { getOrderStatusWildcardTopic } from \"@/utils/mqttTopic\";\r\n\r\n// ✨ 修改：useNotifications 現在接受 userId 作為參數\r\nexport default function useNotifications(userId) {\r\n    // 移除 useUser 相關的 state\r\n    // const { user, loading: userLoading } = useUser();\r\n    \r\n    const [notifications, setNotifications] = useState([]);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n    const [topic, setTopic] = useState(\"\");\r\n\r\n    // MQTT 訂閱的主題現在依賴於傳入的 userId\r\n    const { messages } = useMqttClient({\r\n        subscribeTopics: userId ? [getOrderStatusWildcardTopic(userId)] : [], // ✨ 修改：訂閱主題基於 userId\r\n    });\r\n\r\n    // 提取通知載入邏輯到 useCallback 函數中\r\n    const fetchNotifications = useCallback(async () => {\r\n        // ✨ 關鍵檢查：如果 userId 不存在，則直接返回\r\n        if (!userId) {\r\n            setNotifications([]); // 清空通知\r\n            setUnreadCount(0);\r\n            setLoading(false); // 停止載入狀態\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        // 設定 MQTT topic\r\n        setTopic(getOrderStatusWildcardTopic(userId)); // ✨ 修改：設定 topic 依賴 userId\r\n\r\n        try {\r\n            // action\r\n            let data = await getUserNotification(userId);\r\n            if (!data) {\r\n                // api (作為備用或主要方式)\r\n                const response = await fetch(\r\n                    `/api/notifications/users/${userId}`\r\n                );\r\n                if (!response.ok) {\r\n                    console.error(\"取得使用者通知失敗\");\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n                data = await response.json();\r\n            }\r\n\r\n            const formedData = data.map((item) => {\r\n                return {\r\n                    id: item.id,\r\n                    title: \"訂單\",\r\n                    type: \"order\",\r\n                    content: item.message,\r\n                    read: item.isRead,\r\n                    time: new Date(item.createdAt).toLocaleString(\"sv\"),\r\n                };\r\n            });\r\n            setNotifications(formedData);\r\n            setUnreadCount(formedData.filter((n) => !n.read).length);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error(\"載入通知時發生錯誤:\", error);\r\n            setLoading(false);\r\n        }\r\n    }, [userId]); // ✨ 依賴於 userId\r\n\r\n    // 初始載入通知的 useEffect\r\n    useEffect(() => {\r\n        // ✨ 移除 userLoading 和 user.id 的檢查，因為現在直接依賴 userId props\r\n        fetchNotifications(); // ✨ 調用提取出來的 fetchNotifications\r\n    }, [fetchNotifications]); // ✨ 依賴於 fetchNotifications\r\n\r\n    // 當收到新的 MQTT 訊息時更新通知\r\n    useEffect(() => {\r\n        // ✨ 增加安全檢查：如果 userId 不存在，則不處理 MQTT 訊息\r\n        if (!userId || messages.length === 0) {\r\n            return;\r\n        }\r\n        try {\r\n            const lastMessage = messages[messages.length - 1];\r\n            // 確認消息是否為字串，並嘗試解析\r\n            const newOrder = JSON.parse(lastMessage.payload.toString()); // ✨ 確保 payload 是字串\r\n\r\n            setNotifications((prev) => {\r\n                // 防止重複添加相同的通知 (如果 MQTT 有可能重發)\r\n                if (prev.some(n => n.id === newOrder.id)) {\r\n                    return prev;\r\n                }\r\n                // 假設 newOrder 已經是與 formedData 相同格式的物件\r\n                return [newOrder, ...prev];\r\n            });\r\n            setUnreadCount((prev) => prev + 1);\r\n        } catch (err) {\r\n            console.error(\"無法解析 MQTT 訊息:\", err);\r\n        }\r\n    }, [messages, userId]); // ✨ 依賴中加入 userId\r\n\r\n    const notificationSetter = (notifications) => {\r\n        setNotifications(notifications);\r\n        const unreadCount = notifications.filter(\r\n            (n) => n.read === false\r\n        ).length;\r\n        setUnreadCount(unreadCount);\r\n    };\r\n\r\n    return {\r\n        notifications,\r\n        setNotifications: notificationSetter,\r\n        unreadCount,\r\n        loading,\r\n        // 如果外部組件需要，也可以暴露 fetchNotifications\r\n        fetchNotifications \r\n    };\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/actions/notification.js"],"sourcesContent":["// app/actions/notification.js (修正後)\r\n\"use server\"; // ✨ 必須有這行，將其標記為 Server Actions\r\n\r\nimport { prisma } from '@/lib/prisma'; // ✨ 導入具名導出的 prisma 客戶端\r\n\r\nexport const addNotification = async (body, userId) => {\r\n    try {\r\n        // ✨ 這裡應該是添加通知到資料庫的邏輯\r\n        if (!userId || !body || !body.message || !body.orderId || !body.title || !body.type) {\r\n            throw new Error(\"Missing notification data or userId.\");\r\n        }\r\n        const newNotification = await prisma.notification.create({\r\n            data: {\r\n                userId: userId,\r\n                orderId: body.orderId, // 假設 body 包含 orderId\r\n                message: body.message,\r\n                // 其他欄位如 isRead 會有 default 值\r\n                // title 和 type 需要在你的 Notification model 中定義或處理\r\n            }\r\n        });\r\n        return { success: true, notification: newNotification };\r\n    } catch (error) {\r\n        console.error(\"Failed to add notification (Server Action):\", error);\r\n        return { error: error.message };\r\n    }\r\n};\r\n\r\nexport const getUserNotification = async (userId) => {\r\n    try {\r\n        // ✨ 這裡應該是從資料庫獲取使用者通知的邏輯\r\n        if (!userId) {\r\n            throw new Error(\"User ID is required for fetching notifications.\");\r\n        }\r\n        const notifications = await prisma.notification.findMany({\r\n            where: { userId: userId },\r\n            orderBy: { createdAt: 'desc' }, // 按最新排序\r\n        });\r\n        return notifications;\r\n    } catch (error) {\r\n        console.error(\"Failed to get user notifications (Server Action):\", error);\r\n        return { error: error.message }; // 返回錯誤訊息，以便前端處理\r\n    }\r\n};\r\n\r\nexport const deleteNotification = async (notificationId) => {\r\n    try {\r\n        // ✨ 這裡應該是從資料庫刪除通知的邏輯\r\n        if (!notificationId) {\r\n            throw new Error(\"Notification ID is required for deleting.\");\r\n        }\r\n        await prisma.notification.delete({\r\n            where: { id: notificationId },\r\n        });\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Failed to delete notification (Server Action):\", error);\r\n        // 如果是找不到通知的錯誤，可以更精確地處理\r\n        if (error.code === 'P2025') {\r\n            return { error: \"Notification not found.\" };\r\n        }\r\n        return { error: error.message };\r\n    }\r\n};"],"names":[],"mappings":";;;;;;IA4Ca,qBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/components/D%3A/113-2/Breakfast-final-project/app/components/notifyButton.jsx"],"sourcesContent":["// app/components/notifyButton.jsx\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\n// import useUser from \"@/hooks/useUser\"; // ✨ 移除這行，不再需要 useUser\r\nimport useNotifications from \"@/hooks/useNotifications\"; // 保持這行\r\nimport { deleteNotification } from \"@/app/actions/notification\"; // 保持這行\r\n\r\n// ✨ 修改：NotifyButton 現在接受 userId 作為 props\r\nexport default function NotifyButton({ userId }) {\r\n    const [showNotify, setShowNotify] = useState(false);\r\n    // ✨ 修改：直接將 userId 傳遞給 useNotifications\r\n    // useNotifications 內部將負責處理 userId 是否存在的邏輯\r\n    const { notifications, unreadCount, setNotifications } = useNotifications(userId);\r\n    const wrapperRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        // ✨ 修改：這裡的 loading 檢查現在應該由 userId 是否存在來判斷，\r\n        // 因為 useNotifications 內部已經處理了載入狀態\r\n        // 如果 userId 不存在，則直接返回，不需監聽點擊外部事件，因為按鈕根本不應該出現\r\n        if (!userId) {\r\n            return;\r\n        }\r\n\r\n        const handleClickOutside = (event) => {\r\n            if (\r\n                wrapperRef.current &&\r\n                !wrapperRef.current.contains(event.target)\r\n            ) {\r\n                setShowNotify(false);\r\n            }\r\n        };\r\n\r\n        if (showNotify) {\r\n            document.addEventListener(\"mousedown\", handleClickOutside);\r\n        } else {\r\n            document.removeEventListener(\"mousedown\", handleClickOutside);\r\n        }\r\n\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", handleClickOutside);\r\n        };\r\n    }, [showNotify, userId]); // ✨ 依賴中加入 userId\r\n\r\n    const handelClickNotificationButton = async () => {\r\n        // ✨ 增加安全檢查：如果 userId 不存在，則直接返回\r\n        if (!userId) {\r\n            alert(\"用戶未登入，無法操作通知。\");\r\n            return;\r\n        }\r\n\r\n        setShowNotify((prev) => !prev);\r\n\r\n        // 如果要標記為已讀，確保有通知才操作\r\n        if (notifications.length > 0) {\r\n            setNotifications(\r\n                notifications.map((n) => {\r\n                    return { ...n, read: true };\r\n                })\r\n            );\r\n\r\n            try {\r\n                // ✨ 修改：使用 userId 而不是 user.id\r\n                const response = await fetch(\r\n                    `/api/notifications/users/${userId}/isRead`,\r\n                    {\r\n                        method: \"PATCH\",\r\n                    }\r\n                );\r\n                if (!response.ok) {\r\n                    alert(\"切換已讀通知失敗\");\r\n                }\r\n            } catch (err) {\r\n                alert(\"錯誤：\" + err.message); // 更友善地顯示錯誤訊息\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleDeleteNotification = async (nId) => {\r\n        // ✨ 增加安全檢查：如果 userId 不存在，則直接返回\r\n        if (!userId) {\r\n            alert(\"用戶未登入，無法刪除通知。\");\r\n            return;\r\n        }\r\n\r\n        // 這裡你的程式碼使用了 deleteNotification(nId) 和 fetch /api/notifications/${nId} 兩種方式\r\n        // 建議只保留一種，通常是 API route 方式。\r\n        // 如果 deleteNotification 是一個 Server Action，它應該是獨立且最終的。\r\n        // 為了簡單起見，我會假設你最終透過 API route 處理，或者 deleteNotification 內部會調用 API。\r\n\r\n        try {\r\n            const data = await deleteNotification(nId); // 這是 Server Action\r\n            if (!data || data.error) { // 檢查 Server Action 的結果\r\n                 // 如果 Server Action 失敗，可以選擇呼叫 API route 作為備用或只依賴一個\r\n                const response = await fetch(`/api/notifications/${nId}`, {\r\n                    method: \"DELETE\",\r\n                });\r\n                if (!response.ok) {\r\n                    alert(\"刪除通知失敗\");\r\n                    return;\r\n                }\r\n            }\r\n        } catch (err) {\r\n            alert(\"刪除通知錯誤：\" + err.message);\r\n            return;\r\n        }\r\n        \r\n        setNotifications(notifications.filter((n) => n.id !== nId));\r\n    };\r\n\r\n    // ✨ 關鍵修改：只有當 userId 存在時才渲染整個按鈕組件\r\n    // 如果沒有 userId，代表用戶未登入或會話仍在載入，此時不應該顯示通知按鈕\r\n    if (!userId) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative\" ref={wrapperRef}>\r\n            <button\r\n                aria-label=\"查看通知\"\r\n                className=\"relative focus:outline-none\"\r\n                onClick={handelClickNotificationButton}\r\n            >\r\n                <span className=\"text-xl\">🔔</span>\r\n                {unreadCount > 0 && (\r\n                    <span className=\"absolute -top-1 -right-1 bg-rose-400 text-white text-[10px] px-1.5 py-0.5 rounded-full shadow-sm\">\r\n                        {unreadCount}\r\n                    </span>\r\n                )}\r\n            </button>\r\n\r\n            {showNotify && (\r\n                <div className=\"fixed right-1/12 top-16 w-80 bg-white/90 backdrop-blur-md text-black rounded-xl shadow-2xl border border-gray-200 z-[9999]\">\r\n                    {notifications.length > 0 ? (\r\n                        <ul className=\"divide-y divide-gray-100 max-h-64 overflow-y-auto\">\r\n                            {notifications.map((n) => (\r\n                                <li\r\n                                    key={n.id}\r\n                                    className=\"px-4 py-3 hover:bg-gray-100 transition\"\r\n                                >\r\n                                    <div className=\"font-semibold flex justify-between text-gray-800\">\r\n                                        <p>{n.title}</p>\r\n                                        <button\r\n                                            onClick={() =>\r\n                                                handleDeleteNotification(n.id)\r\n                                            }\r\n                                            style={{\r\n                                                width: \"32px\",\r\n                                                height: \"32px\",\r\n                                                borderRadius: \"50%\",\r\n                                            }}\r\n                                            className=\"flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-gray-200 border border-gray-300 transition cursor-pointer shadow-sm\"\r\n                                            aria-label=\"刪除通知\"\r\n                                            title=\"刪除\"\r\n                                        >\r\n                                            X\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"text-sm text-gray-800\">\r\n                                        {n.content}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-gray-500\">\r\n                                        {n.time}\r\n                                    </div>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    ) : (\r\n                        <div className=\"p-5 text-center text-gray-500 text-sm\">\r\n                            目前沒有通知\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}"],"names":["useEffect","useRef","useState","useNotifications","deleteNotification","NotifyButton","userId","showNotify","setShowNotify","notifications","unreadCount","setNotifications","wrapperRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","handelClickNotificationButton","alert","prev","length","map","n","read","response","fetch","method","ok","err","message","handleDeleteNotification","nId","data","error","filter","id","title","width","height","borderRadius","content","time"],"mappings":"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","debugId":null}},
    {"offset": {"line": 622, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/components/D%3A/113-2/Breakfast-final-project/app/components/navbar.jsx"],"sourcesContent":["// app/components/navbar.jsx\r\n\"use client\";\r\n\r\nimport { useSession, signOut } from \"next-auth/react\";\r\nimport Link from \"next/link\";\r\n// ✨ 移除這行：import { useEffect, useState } from \"react\";\r\n// ✨ 移除這行：import useUser from \"@/hooks/useUser\"; // 不再需要 useUser hook\r\n\r\nimport NotifyButton from \"@/app/components/notifyButton\"; // 通知按鈕保持不變\r\n\r\nexport default function Navbar() {\r\n    // 直接從 useSession 獲取 session 數據和狀態\r\n    const { data: session, status } = useSession(); // status: \"loading\" | \"authenticated\" | \"unauthenticated\"\r\n\r\n    // ✨ 移除所有與 useUser 和 sessionStorage 相關的 useEffect 和 state\r\n    // const { user, setUser } = useUser();\r\n    // const [isLogin, setIsLogin] = useState(...)\r\n    // useEffect(() => { ... }, [session, status]);\r\n\r\n    const getRoleLinks = () => {\r\n        // 直接從 session.user 獲取角色，並進行安全檢查\r\n        const userRole = session?.user?.role;\r\n\r\n        if (!userRole) return []; // 如果沒有角色（例如未登入或仍在載入），返回空陣列\r\n\r\n        // 根據角色返回對應的導覽連結\r\n        switch (userRole) {\r\n            case \"CUSTOMER\":\r\n                return [\r\n                    { href: \"/menu\", name: \"菜單\" },\r\n                    { href: \"/orders\", name: \"我的訂單\" },\r\n                ];\r\n            case \"STAFF\":\r\n                return [\r\n                    { href: \"/orders/pending\", name: \"等待中的訂單\" },\r\n                    { href: \"/orders/ready\", name: \"完成的訂單\" },\r\n                ];\r\n            case \"CHEF\":\r\n                return [{ href: \"/kitchen\", name: \"廚房訂單\" }];\r\n            case \"OWNER\":\r\n                return [\r\n                    { href: \"/admin/menu\", name: \"菜單管理\" },\r\n                    { href: \"/admin/users\", name: \"使用者管理\" },\r\n                    { href: \"/admin/orders/pending\", name: \"等待中的訂單\" },\r\n                    { href: \"/admin/orders/completed\", name: \"完成的訂單\" },\r\n                    { href: \"/admin/orders/kitchen\", name: \"廚房訂單\" },\r\n                ];\r\n            default:\r\n                return [];\r\n        }\r\n    };\r\n\r\n    const handelSignOut = () => {\r\n        // 只需要調用 signOut() 即可，NextAuth.js 會處理 session 的清除\r\n        signOut({ callbackUrl: \"/login\" }); // 登出後跳轉到登入頁\r\n        // ✨ 移除手動清除 sessionStorage 和 setUser 的邏輯\r\n        // sessionStorage.removeItem(\"user\");\r\n        // setUser(null);\r\n        // setIsLogin(false);\r\n    };\r\n\r\n    // 判斷是否已登入和載入狀態\r\n    const isAuthenticated = status === \"authenticated\";\r\n    const isLoading = status === \"loading\";\r\n\r\n    return (\r\n        <nav className=\"sticky top-0 z-50 bg-gradient-to-r from-orange-400 via-pink-500 to-red-500 text-white shadow-md\">\r\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center overflow-x-auto\">\r\n                <Link\r\n                    href=\"/\"\r\n                    className=\"text-2xl font-bold tracking-wide hover:opacity-90 transition-opacity duration-300\"\r\n                    aria-label=\"前往首頁\"\r\n                >\r\n                    🍽 網路早餐訂餐系統\r\n                </Link>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-4\">\r\n                    {isLoading ? ( // 如果正在載入 session，顯示載入訊息\r\n                        <span className=\"text-sm\">載入中...</span>\r\n                    ) : isAuthenticated ? ( // 如果已認證（登入）\r\n                        <>\r\n                            {getRoleLinks().map((link) => (\r\n                                <Link\r\n                                    key={link.href}\r\n                                    href={link.href}\r\n                                    className=\"text-white font-medium hover:underline hover:text-yellow-200 transition duration-300\"\r\n                                    aria-label={link.name}\r\n                                >\r\n                                    {link.name}\r\n                                </Link>\r\n                            ))}\r\n\r\n                            <span className=\"hidden sm:inline-block font-semibold\">\r\n                                {/* ✨ 使用可選鏈來安全訪問 user.name 或 user.email */}\r\n                                您好，{session?.user?.name || session?.user?.email}\r\n                            </span>\r\n\r\n                            {/* ✨ 關鍵修改：只有當 session.user.id 存在時才渲染 NotifyButton ✨ */}\r\n                            {session.user?.id && <NotifyButton userId={session.user.id} />}\r\n\r\n                            <button\r\n                                onClick={handelSignOut}\r\n                                className=\"bg-white text-pink-600 font-semibold px-3 py-1.5 rounded-md hover:bg-gray-100 transition duration-300\"\r\n                                aria-label=\"登出帳號\"\r\n                            >\r\n                                登出\r\n                            </button>\r\n                        </>\r\n                    ) : ( // 如果未認證（未登入）\r\n                        <Link\r\n                            href=\"/login\"\r\n                            className=\"bg-white text-pink-600 font-semibold px-4 py-1.5 rounded-md hover:bg-gray-100 transition duration-300\"\r\n                            aria-label=\"登入帳號\"\r\n                        >\r\n                            登入\r\n                        </Link>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </nav>\r\n    );\r\n}"],"names":["c","_c","useSession","signOut","Link","NotifyButton","Navbar","$","$i","Symbol","for","data","session","status","t0","user","role","userRole","href","name","getRoleLinks","handelSignOut","_temp","isAuthenticated","isLoading","t1","t2","map","_temp2","email","id","link","callbackUrl"],"mappings":"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","debugId":null}},
    {"offset": {"line": 868, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/components/sessionNavbar.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { SessionProvider } from \"next-auth/react\";\r\nimport React from \"react\";\r\nimport Navbar from \"./navbar\";\r\n\r\nexport default function SessionNavbar({session}) {\r\n    return (\r\n        <SessionProvider session={session}>\r\n            <Navbar />\r\n        </SessionProvider>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,cAAc,EAAC,OAAO,EAAC;IAC3C,qBACI,6LAAC,iJAAA,CAAA,kBAAe;QAAC,SAAS;kBACtB,cAAA,6LAAC,+HAAA,CAAA,UAAM;;;;;;;;;;AAGnB;KANwB","debugId":null}},
    {"offset": {"line": 906, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/components/D%3A/113-2/Breakfast-final-project/app/components/authSessionProvider.jsx"],"sourcesContent":["// app/providers.jsx\r\n\"use client\";\r\nimport { SessionProvider } from \"next-auth/react\";\r\n\r\nexport default function Providers({ children }) {\r\n  return <SessionProvider>{children}</SessionProvider>;\r\n}\r\n"],"names":["c","_c","SessionProvider","Providers","t0","$","$i","Symbol","for","children","t1"],"mappings":"AAAA,oBAAA;;;;;AACa,SAAAA,CAAA,IAAAC,EAAA;AACb,SAASC,eAAe,QAAQ,iBAAiB;AADjD,YAAY;;;;AAGG,mBAAAE,EAAA;IAAA,MAAAC,CAAA,mLAAAJ,IAAAA,AAAA,EAAA;IAAA,IAAAI,CAAA,CAAA,EAAA,KAAA,oEAAA;QAAA,IAAA,IAAAC,EAAA,GAAA,GAAAA,EAAA,GAAA,GAAAA,EAAA,IAAA,EAAA;YAAAD,CAAA,CAAAC,EAAA,CAAA,GAAAC,MAAA,CAAAC,GAAA,CAAA;QAAA;QAAAH,CAAA,CAAA,EAAA,GAAA;IAAA;IAAmB,MAAA,EAAAI,QAAAA,EAAA,GAAAL,EAAY;IAAA,IAAAM,EAAA;IAAA,IAAAL,CAAA,CAAA,EAAA,KAAAI,QAAA,EAAA;QACrCC,EAAA,iBAAA,+UAAC,kBAAe,CAAED;sBAAAA,QAAQ,CAAC,EAA1B,eAAe,CAA6B;;;;;;QAAAJ,CAAA,CAAA,EAAA,GAAAI,QAAA;QAAAJ,CAAA,CAAA,EAAA,GAAAK,EAAA;IAAA,OAAA;QAAAA,EAAA,GAAAL,CAAA,CAAA,EAAA;IAAA;IAAA,OAA7CK,EAA6C;AAAA;KADvCP","debugId":null}},
    {"offset": {"line": 954, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/components/RouteEvents.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function RouterEvents() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const start = () => setLoading(true);\r\n    const end = () => setLoading(false);\r\n\r\n    router.events?.on(\"routeChangeStart\", start);\r\n    router.events?.on(\"routeChangeComplete\", end);\r\n    router.events?.on(\"routeChangeError\", end);\r\n\r\n    return () => {\r\n      router.events?.off(\"routeChangeStart\", start);\r\n      router.events?.off(\"routeChangeComplete\", end);\r\n      router.events?.off(\"routeChangeError\", end);\r\n    };\r\n  }, [router]);\r\n\r\n  if (!loading) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-white/70 z-[9999] flex items-center justify-center\">\r\n      <div className=\"text-gray-700 text-lg font-semibold\">頁面切換中...</div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR,MAAM;gDAAQ,IAAM,WAAW;;YAC/B,MAAM;8CAAM,IAAM,WAAW;;YAE7B,OAAO,MAAM,EAAE,GAAG,oBAAoB;YACtC,OAAO,MAAM,EAAE,GAAG,uBAAuB;YACzC,OAAO,MAAM,EAAE,GAAG,oBAAoB;YAEtC;0CAAO;oBACL,OAAO,MAAM,EAAE,IAAI,oBAAoB;oBACvC,OAAO,MAAM,EAAE,IAAI,uBAAuB;oBAC1C,OAAO,MAAM,EAAE,IAAI,oBAAoB;gBACzC;;QACF;iCAAG;QAAC;KAAO;IAEX,IAAI,CAAC,SAAS,OAAO;IAErB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBAAsC;;;;;;;;;;;AAG3D;GA1BwB;;QACP,qIAAA,CAAA,YAAS;;;KADF","debugId":null}}]
}