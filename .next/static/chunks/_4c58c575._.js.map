{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/hooks/useUser.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport default function useUser() {\r\n    const [user, setUser] = useState({});\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const user = sessionStorage.getItem(\"user\");\r\n        setUser(JSON.parse(user));\r\n        setLoading(false);\r\n    }, []);\r\n    const userSetter = (user) => {\r\n        if (!user) {\r\n            sessionStorage.removeItem(\"user\");\r\n            setUser({});\r\n            return;\r\n        }\r\n        sessionStorage.setItem(\"user\", JSON.stringify(user));\r\n        setUser(user);\r\n    };\r\n\r\n    return { user, setUser: userSetter, loading };\r\n}\r\n"],"names":[],"mappings":";;;AAEA;;AAFA;;AAIe,SAAS;;IACpB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE,CAAC;IAClC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;6BAAE;YACN,MAAM,OAAO,eAAe,OAAO,CAAC;YACpC,QAAQ,KAAK,KAAK,CAAC;YACnB,WAAW;QACf;4BAAG,EAAE;IACL,MAAM,aAAa,CAAC;QAChB,IAAI,CAAC,MAAM;YACP,eAAe,UAAU,CAAC;YAC1B,QAAQ,CAAC;YACT;QACJ;QACA,eAAe,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;QAC9C,QAAQ;IACZ;IAEA,OAAO;QAAE;QAAM,SAAS;QAAY;IAAQ;AAChD;GApBwB","debugId":null}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/actions/order.js"],"sourcesContent":["// app/actions/order.js\r\n\r\nexport const addOrder = async (body) => {\r\n  const response = await fetch(\"/api/order/checkout\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(body),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(\"送出訂單失敗\");\r\n  }\r\n\r\n  return response.json();\r\n};\r\n\r\n// 其他函式目前先保留 null，未來可以實作\r\nexport const getCustomerOrder = async (customerId) => {\r\n  return null;\r\n};\r\nexport const editOrderStatus = async (body, orderId) => {\r\n  return null;\r\n};\r\nexport const getPendingOrders = async () => {\r\n  return null;\r\n};\r\nexport const getKitchenOrders = async () => {\r\n  return null;\r\n};\r\nexport const getReadyOrders = async () => {\r\n  return null;\r\n};\r\nexport const getOrderById = async () => {\r\n  return null;\r\n};\r\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;;;;;;AAEhB,MAAM,WAAW,OAAO;IAC7B,MAAM,WAAW,MAAM,MAAM,uBAAuB;QAClD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,mBAAmB,OAAO;IACrC,OAAO;AACT;AACO,MAAM,kBAAkB,OAAO,MAAM;IAC1C,OAAO;AACT;AACO,MAAM,mBAAmB;IAC9B,OAAO;AACT;AACO,MAAM,mBAAmB;IAC9B,OAAO;AACT;AACO,MAAM,iBAAiB;IAC5B,OAAO;AACT;AACO,MAAM,eAAe;IAC1B,OAAO;AACT","debugId":null}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/orders/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useMqttClient } from \"@/hooks/useMqttClient\";\r\nimport useUser from \"@/hooks/useUser\";\r\nimport { editOrderStatus, getCustomerOrder } from \"@/app/actions/order\";\r\n\r\nexport default function OrdersPage() {\r\n    const [orders, setOrders] = useState([]);\r\n    const [topic, setTopic] = useState(\"\");\r\n    const { user, loading } = useUser();\r\n\r\n    const { messages, publishMessage } = useMqttClient({\r\n        subscribeTopics: topic ? [topic] : [],\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (loading) {\r\n            return;\r\n        }\r\n        setTopic(getKitchenReadyOrderTopic(\"#\"));\r\n\r\n        const getOrders = async () => {\r\n            try {\r\n                // action\r\n                let data = await getCustomerOrder(user.id);\r\n                if (!data) {\r\n                    // api\r\n                    const response = await fetch(\r\n                        `/api/orders/customers/${user.id}`\r\n                    );\r\n                    data = await response.json();\r\n                }\r\n                setOrders(data);\r\n            } catch (err) {\r\n                alert(\"獲取顧客訂單失敗\");\r\n            }\r\n        };\r\n        getOrders();\r\n    }, [loading]);\r\n\r\n    // 當收到 MQTT 訊息時，更新訂單狀態\r\n    useEffect(() => {\r\n        if (messages.length === 0) return;\r\n\r\n        const lastMessage = messages[messages.length - 1];\r\n\r\n        const payload = JSON.parse(lastMessage.payload);\r\n\r\n        const status = payload.status;\r\n        const orderId = payload.orderId;\r\n\r\n        setOrders((prev) => {\r\n            return prev.map((order) =>\r\n                order.id === orderId ? { ...order, status } : order\r\n            );\r\n        });\r\n    }, [messages]);\r\n\r\n    const getStatusText = (status) => {\r\n        switch (status) {\r\n            case \"PENDING\":\r\n                return \"店家未接單\";\r\n            case \"PREPARING\":\r\n                return \"餐點準備中\";\r\n            case \"READY\":\r\n                return \"餐點可領取\";\r\n            case \"COMPLETED\":\r\n                return \"交易完成\";\r\n            case \"CANCELLED\":\r\n                return \"交易取消\";\r\n            default:\r\n                return \"錯誤...\";\r\n        }\r\n    };\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case \"PENDING\":\r\n                return \"bg-yellow-100 text-yellow-800\";\r\n            case \"PREPARING\":\r\n                return \"bg-blue-100 text-blue-800\";\r\n            case \"READY\":\r\n                return \"bg-green-100 text-green-800\";\r\n            case \"COMPLETED\":\r\n                return \"bg-gray-100 text-gray-800\";\r\n            case \"CANCELLED\":\r\n                return \"bg-red-100 text-red-800\";\r\n            default:\r\n                return \"bg-gray-100 text-gray-800\";\r\n        }\r\n    };\r\n    const handleCancelOrderButton = async (orderId) => {\r\n        try {\r\n            // action\r\n            let data = await editOrderStatus(\r\n                {\r\n                    status: \"CANCELLED\",\r\n                },\r\n                orderId\r\n            );\r\n            if (!data) {\r\n                // api\r\n                const response = await fetch(`/api/orders/${orderId}/status`, {\r\n                    method: \"PATCH\",\r\n                    body: JSON.stringify({\r\n                        status: \"CANCELLED\",\r\n                    }),\r\n                });\r\n                if (!response.ok) {\r\n                    alert(\"訂單取消失敗\");\r\n                    return;\r\n                }\r\n            }\r\n            setOrders((prev) =>\r\n                prev.map((order) =>\r\n                    order.id !== orderId\r\n                        ? order\r\n                        : { ...order, status: \"CANCELLED\" }\r\n                )\r\n            );\r\n\r\n            // 發布訂單取消的 MQTT 訊息\r\n            const topic = \"\"; // TODO: 設定 MQTT 主題\r\n            // TODO: 準備訊息內容\r\n\r\n            // TODO: 發布 MQTT 訊息\r\n        } catch (error) {\r\n            alert(\"訂單取消失敗\");\r\n        }\r\n    };\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-orange-100 via-pink-100 to-red-100 px-4 sm:px-6 py-8\">\r\n            <div className=\"max-w-4xl mx-auto\">\r\n                <h1 className=\"text-3xl font-bold mb-6 text-center sm:text-left text-gray-800\">\r\n                    我的訂單\r\n                </h1>\r\n\r\n                {orders.length === 0 ? (\r\n                    <p className=\"text-gray-500 text-center sm:text-left\">\r\n                        您目前沒有任何訂單。\r\n                    </p>\r\n                ) : (\r\n                    <div className=\"space-y-6\">\r\n                        {orders.map((order) => (\r\n                            <div\r\n                                key={order.id}\r\n                                className=\"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition\"\r\n                            >\r\n                                <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4\">\r\n                                    <div>\r\n                                        <h3 className=\"text-lg font-bold text-gray-800\">\r\n                                            訂單 #{order.id.slice(0, 8)}\r\n                                        </h3>\r\n                                        <p className=\"text-sm text-gray-500\">\r\n                                            {new Date(\r\n                                                order.createdAt\r\n                                            ).toLocaleString()}\r\n                                        </p>\r\n                                    </div>\r\n                                    <span\r\n                                        className={`mt-2 sm:mt-0 px-3 py-2 rounded-full text-xs font-medium ${getStatusColor(\r\n                                            order.status\r\n                                        )}`}\r\n                                    >\r\n                                        {getStatusText(order.status)}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div className=\"mb-3 space-y-1\">\r\n                                    <p className=\"text-gray-700\">\r\n                                        <strong>總金額：</strong> $\r\n                                        {order.totalAmount.toFixed(2)}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"border-t pt-4\">\r\n                                    <h4 className=\"text-sm font-semibold mb-2 text-gray-700\">\r\n                                        餐點內容：\r\n                                    </h4>\r\n                                    <ul className=\"space-y-2\">\r\n                                        {order.items.map((item) => (\r\n                                            <li\r\n                                                key={item.id}\r\n                                                className=\"flex justify-between text-sm text-gray-600\"\r\n                                            >\r\n                                                <span>\r\n                                                    {item.menuItem.name} ×{\" \"}\r\n                                                    {item.quantity}\r\n                                                    {item.specialRequest && (\r\n                                                        <span className=\"block text-xs text-gray-400\">\r\n                                                            備註：\r\n                                                            {\r\n                                                                item.specialRequest\r\n                                                            }\r\n                                                        </span>\r\n                                                    )}\r\n                                                </span>\r\n                                                <span>\r\n                                                    $\r\n                                                    {(\r\n                                                        item.menuItem.price *\r\n                                                        item.quantity\r\n                                                    ).toFixed(2)}\r\n                                                </span>\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                </div>\r\n                                {order.status === \"PENDING\" && (\r\n                                    <div className=\"mt-4 text-center sm:text-right\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                handleCancelOrderButton(\r\n                                                    order.id\r\n                                                );\r\n                                            }}\r\n                                            className=\"inline-block bg-gradient-to-r from-red-400 to-red-600 text-white px-5 py-2 rounded-md hover:opacity-90 transition\"\r\n                                        >\r\n                                            取消訂單\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}