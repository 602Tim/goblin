{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/orders/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport mqtt from \"mqtt\";\r\nimport { useSession } from \"next-auth/react\";\r\n\r\nexport default function OrdersPage() {\r\n  const { data: session, status } = useSession();\r\n  const [orders, setOrders] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (status === \"loading\") return; // Á≠âÂæÖ session ËºâÂÖ•\r\n\r\n    if (!session) {\r\n      alert(\"Ë´ãÂÖàÁôªÂÖ•\");\r\n      return;\r\n    }\r\n\r\n    let client;\r\n\r\n    const getOrders = async () => {\r\n      try {\r\n        const response = await fetch(\"/api/order/list\", {\r\n          credentials: \"include\",\r\n        });\r\n        if (!response.ok) throw new Error(\"‰º∫ÊúçÂô®ÈåØË™§\");\r\n\r\n        const data = await response.json();\r\n\r\n        // ‚úÖ Âä†‰∏äÈÄôÊÆµÔºöÂè™È°ØÁ§∫ÈÄ≤Ë°å‰∏≠ÁöÑË®ÇÂñÆ\r\n        const ongoingOrders = data.filter(\r\n          (o) => o.status !== \"COMPLETED\" && o.status !== \"CANCELLED\"\r\n        );\r\n\r\n        setOrders(ongoingOrders);\r\n\r\n        // MQTT Ë®ÇÈñ±...\r\n        client = mqtt.connect(\"wss://broker.emqx.io:8084/mqtt\");\r\n        client.on(\"connect\", () => {\r\n          console.log(\"üì° MQTT Â∑≤ÈÄ£Á∑öÔºàÈ°ßÂÆ¢Ôºâ\");\r\n          client.subscribe(`U1113007/orders/updated/+`);\r\n        });\r\n\r\n        client.on(\"message\", (topic, message) => {\r\n          try {\r\n            const payload = JSON.parse(message.toString());\r\n            console.log(\"üì¨ Êî∂Âà∞Ë®ÇÂñÆÊõ¥Êñ∞Ôºö\", payload);\r\n            if (payload.orderId) {\r\n              getOrders(); // ÈáçÊñ∞ÊäìË≥áÊñô\r\n            }\r\n          } catch (err) {\r\n            console.error(\"‚ùå MQTT Ë®äÊÅØËß£ÊûêÈåØË™§\", err);\r\n          }\r\n        });\r\n      } catch (err) {\r\n        console.error(\"‚ùå ËÆÄÂèñË®ÇÂñÆÂ§±ÊïóÔºö\", err);\r\n        setOrders([]);\r\n      }\r\n    };\r\n\r\n    getOrders();\r\n\r\n    return () => {\r\n      if (client) client.end();\r\n    };\r\n  }, [session, status]);\r\n\r\n  // ‰ª•‰∏ã‰∏çËÆäÔºåÁúÅÁï•... \r\n  // getStatusColor, getDisplayStatus, return JSX\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"PENDING\":\r\n        return \"bg-yellow-100 text-yellow-800\";\r\n      case \"PREPARING\":\r\n        return \"bg-blue-100 text-blue-800\";\r\n      case \"READY\":\r\n        return \"bg-green-100 text-green-800\";\r\n      case \"COMPLETED\":\r\n        return \"bg-gray-100 text-gray-800\";\r\n      case \"CANCELLED\":\r\n        return \"bg-red-100 text-red-800\";\r\n      default:\r\n        return \"bg-gray-100 text-gray-800\";\r\n    }\r\n  };\r\n\r\n  const getDisplayStatus = (status) => {\r\n    switch (status) {\r\n      case \"PENDING\":\r\n        return \"Á≠âÂæÖÊé•ÂñÆ\";         // Â∞öÊú™Êé•ÂñÆ\r\n      case \"PREPARING\":\r\n        return \"È§êÈªûË£Ω‰Ωú‰∏≠\";       // Â∫óÂì°Â∑≤Êé•ÂñÆÔºåË£Ω‰Ωú‰∏≠\r\n      case \"READY\":\r\n        return \"È§êÈªûË£Ω‰ΩúÂÆåÊàêÔºåË´ãÂèñÈ§ê\"; // Ë£Ω‰ΩúÂÆåÊàê„ÄÅ‰ªòÊ¨æÂÆåÊàêÔºåÂ∑≤ÈÄöÁü•ÂèñÈ§ê\r\n      case \"COMPLETED\":\r\n        return \"ÂèñÈ§êÂÆåÊàê\";         // È°ßÂÆ¢Â∑≤ÂÆåÊàêÂèñÈ§ê\r\n      case \"CANCELLED\":\r\n        return \"Â∑≤ÂèñÊ∂à\";           // Ë®ÇÂñÆË¢´ÂèñÊ∂à\r\n      default:\r\n        return status;\r\n    }\r\n  };\r\n\r\n\r\n  if (status === \"loading\") {\r\n    return <p>ËÆÄÂèñ‰∏≠...</p>;\r\n  }\r\n\r\n  if (!session) {\r\n    return <p>Ë´ãÂÖàÁôªÂÖ•ÊâçËÉΩÊü•ÁúãË®ÇÂñÆ</p>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-orange-100 via-pink-100 to-red-100 px-4 sm:px-6 py-8\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold mb-6 text-center sm:text-left text-gray-800\">ÊàëÁöÑË®ÇÂñÆ</h1>\r\n\r\n        {orders.length === 0 ? (\r\n          <p className=\"text-gray-500 text-center sm:text-left\">ÊÇ®ÁõÆÂâçÊ≤íÊúâ‰ªª‰ΩïË®ÇÂñÆ„ÄÇ</p>\r\n        ) : (\r\n          <div className=\"space-y-6\">\r\n            {orders.map((order) => (\r\n              <div key={order.id} className=\"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition\">\r\n                <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-bold text-gray-800\">Ë®ÇÂñÆ #{order.id.slice(0, 8)}</h3>\r\n                    <p className=\"text-sm text-gray-500\">{new Date(order.createdAt).toLocaleString()}</p>\r\n                  </div>\r\n                  <span className={`mt-2 sm:mt-0 px-3 py-2 rounded-full text-xs font-medium ${getStatusColor(order.status)}`}>\r\n                    {getDisplayStatus(order.status)}\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"mb-3 space-y-1\">\r\n                  <p className=\"text-gray-700\">\r\n                    <strong>Á∏ΩÈáëÈ°çÔºö</strong> ${order.totalAmount.toFixed(2)}\r\n                  </p>\r\n                  <p className={order.paymentStatus ? \"text-green-600\" : \"text-red-600\"}>\r\n                    <strong>‰ªòÊ¨æÁãÄÊÖãÔºö</strong> {order.paymentStatus ? \"Â∑≤‰ªòÊ¨æ\" : \"Êú™‰ªòÊ¨æ\"}\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"border-t pt-4\">\r\n                  <h4 className=\"text-sm font-semibold mb-2 text-gray-700\">È§êÈªûÂÖßÂÆπÔºö</h4>\r\n                  <ul className=\"space-y-2\">\r\n                    {order.items.map((item) => (\r\n                      <li key={item.id} className=\"flex justify-between text-sm text-gray-600\">\r\n                        <span>\r\n                          {item.menuItem?.name || \"Êú™Áü•ÂìÅÈ†Ö\"} √ó {item.quantity}\r\n                          {item.specialRequest && (\r\n                            <span className=\"block text-xs text-gray-400\">ÂÇôË®ªÔºö{item.specialRequest}</span>\r\n                          )}\r\n                        </span>\r\n                        <span>\r\n                          ${((item.menuItem?.price ?? 0) * item.quantity).toFixed(2)}\r\n                        </span>\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n\r\n                {order.status === \"READY\" && !order.completedAt && (\r\n                  <div className=\"mt-4 text-center sm:text-right\">\r\n                    <Link\r\n                      href={`/orders/${order.id}/complete`}\r\n                      className=\"inline-block bg-gradient-to-r from-green-500 to-green-700 text-white px-5 py-2 rounded-md hover:opacity-90 transition\"\r\n                    >\r\n                      Á¢∫Ë™çÂèñÈ§ê\r\n                    </Link>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}