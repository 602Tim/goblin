{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/actions/order.js"],"sourcesContent":["// app/actions/order.js\r\n\r\nexport const addOrder = async (body) => {\r\n  const response = await fetch(\"/api/order/checkout\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(body),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(\"送出訂單失敗\");\r\n  }\r\n\r\n  return response.json();\r\n};\r\n\r\nexport const getCustomerOrder = async (customerId) => {\r\n    return null;\r\n};\r\nexport const editOrderStatus = async (body, orderId) => {\r\n    return null;\r\n};\r\nexport const getPendingOrders = async () => {\r\n    return null;\r\n};\r\nexport const getKitchenOrders = async () => {\r\n    return null;\r\n};\r\nexport const getReadyOrders = async () => {\r\n    return null;\r\n};\r\nexport const getOrderById = async () => {\r\n    return null;\r\n};\r\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;;;;;;AAEhB,MAAM,WAAW,OAAO;IAC7B,MAAM,WAAW,MAAM,MAAM,uBAAuB;QAClD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,mBAAmB,OAAO;IACnC,OAAO;AACX;AACO,MAAM,kBAAkB,OAAO,MAAM;IACxC,OAAO;AACX;AACO,MAAM,mBAAmB;IAC5B,OAAO;AACX;AACO,MAAM,mBAAmB;IAC5B,OAAO;AACX;AACO,MAAM,iBAAiB;IAC1B,OAAO;AACX;AACO,MAAM,eAAe;IACxB,OAAO;AACX","debugId":null}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/actions/menu.js"],"sourcesContent":["// app/actions/menu.js\r\n'use server'; // 標記為 Server Action\r\n\r\nimport { prisma } from '@/lib/prisma'; // 引入 Prisma 客戶端\r\nimport { promises as fs } from 'fs'; // 引入 Node.js 的檔案系統模組\r\nimport path from 'path'; // 引入 Node.js 的路徑模組\r\n\r\n// 如果未來有單獨上傳圖片的需求，可以填充這個函數\r\n// 目前，圖片處理會整合到 addMenuItem 中\r\nexport const uploadMenuImage = async (body) => {\r\n    console.warn(\"uploadMenuImage 函數目前未實作，圖片處理已整合到 addMenuItem。\");\r\n    return null;\r\n};\r\n\r\n/**\r\n * 管理員新增菜單項目\r\n * 接收 FormData 物件，處理圖片上傳並將菜單資訊存入資料庫。\r\n * @param {FormData} formData - 包含菜單名稱、價格和圖片檔案的 FormData 物件。\r\n * @returns {Promise<{ success: boolean, message: string, data?: any }>}\r\n */\r\nexport const addMenuItem = async (formData) => {\r\n  const name = formData.get('name');\r\n  const price = formData.get('price');\r\n  const imageFile = formData.get('image'); // 獲取 File 物件\r\n\r\n  // 1. 數據驗證\r\n  if (!name || typeof name !== 'string' || name.trim() === '') {\r\n    return { success: false, message: '菜單名稱是必填項。' };\r\n  }\r\n  if (!price || isNaN(parseFloat(price)) || parseFloat(price) <= 0) {\r\n    return { success: false, message: '價格必須是有效的正數。' };\r\n  }\r\n  if (!(imageFile instanceof File) || imageFile.size === 0) {\r\n    return { success: false, message: '圖片檔案是必填項。' };\r\n  }\r\n\r\n  try {\r\n    // 2. 處理圖片儲存到 public 資料夾\r\n    // 為了避免檔名衝突，給圖片生成一個唯一檔名\r\n    const fileExtension = path.extname(imageFile.name); // 獲取原始副檔名\r\n    const uniqueFileName = `${Date.now()}-${Math.random().toString(36).substring(2, 8)}${fileExtension}`;\r\n    \r\n    // 定義圖片上傳的目標目錄：/public/uploads\r\n    // process.cwd() 返回 Node.js 進程的當前工作目錄（即專案根目錄）\r\n    const uploadDir = path.join(process.cwd(), 'public', 'uploads');\r\n    const filePath = path.join(uploadDir, uniqueFileName); // 完整檔案路徑\r\n\r\n    // 檢查並創建上傳目錄 (如果 'public/uploads' 不存在)\r\n    await fs.mkdir(uploadDir, { recursive: true });\r\n\r\n    // 將圖片檔案的緩衝區寫入磁碟\r\n    const bytes = await imageFile.arrayBuffer(); // 將 File 物件轉換為 ArrayBuffer\r\n    const buffer = Buffer.from(bytes); // 將 ArrayBuffer 轉換為 Node.js Buffer\r\n    await fs.writeFile(filePath, buffer);\r\n\r\n    // 圖片的公開 URL 路徑，這是 Next.js 會提供的路徑\r\n    const imageUrl = `/uploads/${uniqueFileName}`;\r\n\r\n    // 3. 將菜單資訊存入資料庫\r\n    const newMenuItem = await prisma.MenuItem.create({ // 注意：這裡應該是 MenuItem 模型\r\n      data: {\r\n        name: name.trim(), // 清除名稱前後空白\r\n        price: parseFloat(price), // 確保價格是數字類型\r\n        imageUrl, // 存儲圖片的相對路徑\r\n      },\r\n    });\r\n\r\n    // 4. 返回成功訊息\r\n    return { success: true, message: '菜單新增成功！', data: newMenuItem };\r\n\r\n  } catch (error) {\r\n    console.error('新增菜單失敗:', error);\r\n\r\n    // 處理 Prisma 特定的錯誤，例如名稱重複 (P2002)\r\n    if (error.code === 'P2002' && error.meta?.target?.includes('name')) {\r\n      return { success: false, message: '菜單名稱已存在，請使用不同的名稱。' };\r\n    }\r\n    // 其他一般錯誤\r\n    return { success: false, message: `新增菜單時發生錯誤: ${error.message || '未知錯誤'}` };\r\n  }\r\n};\r\n\r\nexport const getMenuItems = async () => {\r\n    // TODO: 這裡未來會實作取得所有菜單的邏輯 (使用 Prisma)\r\n    return null;\r\n};\r\n\r\nexport const editMenuItem = async (body, menuId) => {\r\n    // TODO: 這裡未來會實作編輯菜單的邏輯 (使用 Prisma)\r\n    return null;\r\n};"],"names":[],"mappings":";;;;;;IAkFa,eAAA,WAAA,GAAA,CAAA,GAAA,sNAAA,CAAA,wBAAA,EAAA,8CAAA,sNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,sNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/checkout/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { addOrder } from \"@/app/actions/order\";\r\nimport { getMenuItems } from \"@/app/actions/menu\";\r\n\r\nexport default function CheckoutPage() {\r\n        const [cart, setCart] = useState([]);\r\n        const [menuItems, setMenuItems] = useState([]);\r\n        const [specialRequests, setSpecialRequests] = useState({});\r\n        const [isSubmitting, setIsSubmitting] = useState(false);\r\n        const [user, setUser] = useState(null);\r\n\r\n        useEffect(() => {\r\n            const sessionUser = sessionStorage.getItem(\"user\");\r\n            if (sessionUser) setUser(JSON.parse(sessionUser));\r\n        }, []);\r\n\r\n        useEffect(() => {\r\n            const savedCart = sessionStorage.getItem(\"cart\");\r\n            if (savedCart) setCart(JSON.parse(savedCart));\r\n            else window.location.href = \"/\";\r\n\r\n            const fetchMenu = async () => {\r\n            try {\r\n                let data = await getMenuItems();\r\n                if (!data) {\r\n                const res = await fetch(\"/api/menu\");\r\n                data = await res.json();\r\n                }\r\n                setMenuItems(data);\r\n            } catch {\r\n                alert(\"取得菜單失敗\");\r\n            }\r\n            };\r\n            fetchMenu();\r\n        }, []);\r\n\r\n        const getTotalPrice = () =>\r\n            cart.reduce((total, cartItem) => {\r\n            const menuItem = menuItems.find((item) => item.id === cartItem.id);\r\n            return total + (menuItem?.price || 0) * cartItem.quantity;\r\n            }, 0);\r\n\r\n        const handleSubmitOrder = async (e) => {\r\n            e.preventDefault();\r\n            setIsSubmitting(true);\r\n            if (!user) {\r\n            alert(\"請先登入\");\r\n            setIsSubmitting(false);\r\n            return;\r\n            }\r\n            try {\r\n            const orderItems = cart.map((item) => ({\r\n                menuItemId: item.id,\r\n                quantity: item.quantity,\r\n                specialRequest: specialRequests[item.id] || \"\",\r\n            }));\r\n\r\n            await addOrder({ userId: user.id, orderItems });\r\n\r\n            sessionStorage.removeItem(\"cart\");\r\n            window.location.href = \"/orders\";\r\n            } catch (error) {\r\n            alert(error.message || \"送出訂單失敗\");\r\n            setIsSubmitting(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"container mx-auto p-6\">\r\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-8 text-center\">\r\n                確認訂單\r\n            </h1>\r\n\r\n            {cart.length === 0 ? (\r\n                <div className=\"text-center text-gray-500 text-lg mt-20\">\r\n                購物車目前是空的，請先選擇餐點。\r\n                </div>\r\n            ) : (\r\n                <form\r\n                onSubmit={handleSubmitOrder}\r\n                className=\"max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-6 space-y-6\"\r\n                >\r\n                    <h2 className=\"text-xl font-semibold text-gray-700\">\r\n                        訂單明細\r\n                    </h2>\r\n\r\n                    <ul className=\"divide-y\">\r\n                        {cart.map((cartItem) => {\r\n                            const menuItem = menuItems.find(\r\n                                (item) => item.id === cartItem.id\r\n                            );\r\n                            if (!menuItem) return null;\r\n\r\n                            return (\r\n                                <li\r\n                                    key={cartItem.id}\r\n                                    className=\"py-4 space-y-2\"\r\n                                >\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-gray-800 font-medium\">\r\n                                            {menuItem.name} ×{\" \"}\r\n                                            {cartItem.quantity}\r\n                                        </span>\r\n                                        <span className=\"text-right font-semibold text-gray-700\">\r\n                                            $\r\n                                            {(\r\n                                                menuItem.price *\r\n                                                cartItem.quantity\r\n                                            ).toFixed(2)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label\r\n                                            htmlFor={`special-request-${cartItem.id}`}\r\n                                            className=\"block text-sm text-gray-500 mb-1\"\r\n                                        >\r\n                                            備註（可選）\r\n                                        </label>\r\n                                        <textarea\r\n                                            id={`special-request-${cartItem.id}`}\r\n                                            className=\"w-full border rounded-md p-2 text-sm text-gray-700 focus:ring-2 focus:ring-blue-300 resize-none\"\r\n                                            rows={2}\r\n                                            placeholder=\"例如：去冰、少糖...\"\r\n                                            value={\r\n                                                specialRequests[cartItem.id] ||\r\n                                                \"\"\r\n                                            }\r\n                                            onChange={(e) =>\r\n                                                setSpecialRequests((prev) => ({\r\n                                                    ...prev,\r\n                                                    [cartItem.id]:\r\n                                                        e.target.value,\r\n                                                }))\r\n                                            }\r\n                                        />\r\n                                    </div>\r\n                                </li>\r\n                            );\r\n                        })}\r\n                    </ul>\r\n\r\n                    <div className=\"border-t pt-4 text-lg font-bold flex justify-between\">\r\n                    <span>總金額：</span>\r\n                    <span>${getTotalPrice().toFixed(2)}</span>\r\n                </div>\r\n\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting || cart.length === 0}\r\n                    className=\"w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 rounded-md shadow hover:opacity-90 disabled:bg-gray-400 transition duration-300\"\r\n                >\r\n                    {isSubmitting ? \"正在送出訂單...\" : \"送出訂單\"}\r\n                </button>\r\n                </form>\r\n            )}\r\n            </div>\r\n        );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}