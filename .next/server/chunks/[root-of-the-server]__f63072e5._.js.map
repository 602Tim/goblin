{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/lib/mqttClient.js"],"sourcesContent":["// lib/mqttClient.js\r\nimport mqtt from \"mqtt\";\r\n\r\nlet client = null;\r\n\r\nexport function getMqttClient() {\r\n  if (!client) {\r\n    client = mqtt.connect(\"wss://broker.emqx.io:8084/mqtt\", {\r\n      clientId: \"kitchen-client-\" + Math.random().toString(16).substr(2, 8),\r\n      clean: true,\r\n      will: {\r\n        topic: \"nuu/shisa/beigo/notify/orderstatus\",\r\n        payload: \"kitchen-client disconnected unexpectedly\",\r\n        qos: 1,\r\n        retain: false,\r\n      },\r\n    });\r\n\r\n    client.on(\"connect\", () => {\r\n      console.log(\"‚úÖ MQTT connected\");\r\n    });\r\n\r\n    client.on(\"reconnect\", () => {\r\n      console.log(\"üîÑ Reconnecting to MQTT...\");\r\n    });\r\n\r\n    client.on(\"close\", () => {\r\n      console.log(\"üì¥ MQTT connection closed\");\r\n    });\r\n\r\n    client.on(\"error\", (err) => {\r\n      console.error(\"‚ùå MQTT error:\", err);\r\n    });\r\n  }\r\n\r\n  return client;\r\n}\r\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;AACpB;;AAEA,IAAI,SAAS;AAEN,SAAS;IACd,IAAI,CAAC,QAAQ;QACX,SAAS,wIAAA,CAAA,UAAI,CAAC,OAAO,CAAC,kCAAkC;YACtD,UAAU,oBAAoB,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG;YACnE,OAAO;YACP,MAAM;gBACJ,OAAO;gBACP,SAAS;gBACT,KAAK;gBACL,QAAQ;YACV;QACF;QAEA,OAAO,EAAE,CAAC,WAAW;YACnB,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO,EAAE,CAAC,aAAa;YACrB,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO,EAAE,CAAC,SAAS;YACjB,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO,EAAE,CAAC,SAAS,CAAC;YAClB,QAAQ,KAAK,CAAC,iBAAiB;QACjC;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/utils/mqttTopic.ts"],"sourcesContent":["const TOPIC_ROOT = process.env.NEXT_PUBLIC_MQTT_TOPIC_ROOT;\r\n\r\nconst getTopicRoot = () => {\r\n    if (!TOPIC_ROOT) {\r\n        throw new Error(\"Êú™Â°´ÂØ´ .env ÁöÑ NEXT_PUBLIC_MQTT_TOPIC_ROOT\");\r\n    }\r\n    return `nuu/shisa/${TOPIC_ROOT}`;\r\n};\r\n\r\nexport const getOrderCheckoutTopic = () => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/checkout`;\r\n};\r\nexport const getAcceptCustomerOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/accept/${customerId}`;\r\n};\r\nexport const getKitchenOrderTopic = () => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/kitchen`;\r\n};\r\nexport const getKitchenReadyOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/ready/${customerId}`;\r\n};\r\nexport const getStaffCompletedOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/completed/${customerId}`;\r\n};\r\nexport const getCustomerCancelOrderTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/cancel/${customerId}`;\r\n};\r\n\r\nexport const getOrderStatusWildcardTopic = (customerId: number | string) => {\r\n    const topicRoot = getTopicRoot();\r\n    return `${topicRoot}/notify/order/+/${customerId}`;\r\n}\r\nexport function getOrderToKitchenTopic() {\r\n  return `nuu/shisa/orders/to-kitchen`;\r\n}\r\n\r\nexport function getNotificationTopicByUserId(userId: string) {\r\n  return `nuu/shisa/notifications/${userId}`;\r\n}\r\nexport function getCustomerOrderUpdateTopic(customerId: string) {\r\n  return `nuu/shisa/customer/${customerId}/orders/updated`;\r\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAM;AAEN,MAAM,eAAe;IACjB,uCAAiB;;IAEjB;IACA,OAAO,CAAC,UAAU,EAAE,YAAY;AACpC;AAEO,MAAM,wBAAwB;IACjC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,sBAAsB,CAAC;AAC/C;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,EAAE,YAAY;AAC3D;AACO,MAAM,uBAAuB;IAChC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,CAAC;AAC9C;AACO,MAAM,4BAA4B,CAAC;IACtC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,oBAAoB,EAAE,YAAY;AAC1D;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,wBAAwB,EAAE,YAAY;AAC9D;AACO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,qBAAqB,EAAE,YAAY;AAC3D;AAEO,MAAM,8BAA8B,CAAC;IACxC,MAAM,YAAY;IAClB,OAAO,GAAG,UAAU,gBAAgB,EAAE,YAAY;AACtD;AACO,SAAS;IACd,OAAO,CAAC,2BAA2B,CAAC;AACtC;AAEO,SAAS,6BAA6B,MAAc;IACzD,OAAO,CAAC,wBAAwB,EAAE,QAAQ;AAC5C;AACO,SAAS,4BAA4B,UAAkB;IAC5D,OAAO,CAAC,mBAAmB,EAAE,WAAW,eAAe,CAAC;AAC1D","debugId":null}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\n// --- Prisma: Singleton ---\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma?: PrismaClient;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ?? new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\n// --- Supabase ---\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  throw new Error(\"‚ùå Supabase Áí∞Â¢ÉËÆäÊï∏Êú™Ë®≠ÂÆö\");\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;;;AAEA,4BAA4B;AAC5B,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY;AAE5C,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B;AAEA,mBAAmB;AACnB,MAAM;AACN,MAAM;AAEN,uCAAsC;;AAEtC;AAEO,MAAM,WAAW,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD,EAAE,aAAa","debugId":null}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///D:/113-2/Breakfast-final-project/app/api/order/checkout/route.js"],"sourcesContent":["// app/api/order/checkout/route.js\r\nimport { getMqttClient } from \"../../../../lib/mqttClient\";\r\nimport { getKitchenOrderTopic } from \"../../../../utils/mqttTopic\";\r\nimport { prisma } from \"../../../../lib/prisma\";\r\nimport { NextResponse } from \"next/server\";\r\nimport { getToken } from \"next-auth/jwt\";\r\n\r\nexport async function POST(req) {\r\n  try {\r\n    const token = await getToken({ req });\r\n    const customerId = token?.id;\r\n\r\n    if (!customerId) {\r\n      return new Response(\"Êú™ÊéàÊ¨äÁöÑ‰ΩøÁî®ËÄÖ\", { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n\r\n    if (!Array.isArray(body.orderItems) || body.orderItems.length === 0) {\r\n      return new Response(\"Áº∫Â∞ëË®ÇÂñÆÈ†ÖÁõÆ\", { status: 400 });\r\n    }\r\n\r\n    for (const item of body.orderItems) {\r\n      if (!item.menuItemId) {\r\n        return new Response(\"Ë®ÇÂñÆÈ†ÖÁõÆÁº∫Â∞ë menuItemId\", { status: 400 });\r\n      }\r\n      if (!item.quantity || item.quantity < 1) {\r\n        return new Response(\"Ë®ÇÂñÆÈ†ÖÁõÆÊï∏Èáè‰∏çÊ≠£Á¢∫\", { status: 400 });\r\n      }\r\n    }\r\n\r\n    const menuItemIds = body.orderItems.map(i => i.menuItemId);\r\n\r\n    const menuItems = await prisma.menuItem.findMany({\r\n      where: { id: { in: menuItemIds } },\r\n      select: { id: true, price: true, isAvailable: true },\r\n    });\r\n\r\n    if (menuItems.length !== menuItemIds.length) {\r\n      return new Response(\"Ë®ÇÂñÆ‰∏≠Êúâ‰∏çÂ≠òÂú®ÁöÑËèúÂñÆÈ†ÖÁõÆ\", { status: 400 });\r\n    }\r\n\r\n    if (menuItems.some(mi => mi.isAvailable === false)) {\r\n      return new Response(\"Ë®ÇÂñÆ‰∏≠ÂåÖÂê´‰∏çÂèØÁî®ÁöÑËèúÂñÆÈ†ÖÁõÆ\", { status: 400 });\r\n    }\r\n\r\n    const priceMap = {};\r\n    menuItems.forEach(mi => {\r\n      priceMap[mi.id] = mi.price;\r\n    });\r\n\r\n    const totalAmount = body.orderItems.reduce((sum, item) => {\r\n      return sum + (priceMap[item.menuItemId] ?? 0) * item.quantity;\r\n    }, 0);\r\n\r\n    const newOrder = await prisma.order.create({\r\n      data: {\r\n        customerId, // ‚úÖ ÊîπÁÇ∫Âæû token ÊãøÁöÑ id\r\n        totalAmount,\r\n        items: {\r\n          create: body.orderItems.map(item => ({\r\n            menuItemId: item.menuItemId,\r\n            quantity: item.quantity,\r\n            specialRequest: item.specialRequest || \"\",\r\n          })),\r\n        },\r\n      },\r\n      include: {\r\n        items: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(newOrder);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Âª∫Á´ãË®ÇÂñÆÈåØË™§:\", error);\r\n    return new Response(\"‰º∫ÊúçÂô®ÈåØË™§\", { status: 500 });\r\n  }\r\n}\r\nconst mqtt = getMqttClient();\r\nconst topic = getKitchenOrderTopic();\r\nmqtt.publish(topic, JSON.stringify(newOrder), { qos: 1 }, (err) => {\r\n  if (err) {\r\n    console.error(\"‚ùå MQTT Áôº‰ΩàÂ§±Êïó:\", err);\r\n  } else {\r\n    console.log(\"üì¢ Â∑≤ÈÄöÁü•ÂªöÊàøÊñ∞Ë®ÇÂñÆ\");\r\n  }\r\n});"],"names":[],"mappings":"AAAA,kCAAkC;;;;AAClC;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,QAAQ,MAAM,CAAA,GAAA,8IAAA,CAAA,WAAQ,AAAD,EAAE;YAAE;QAAI;QACnC,MAAM,aAAa,OAAO;QAE1B,IAAI,CAAC,YAAY;YACf,OAAO,IAAI,SAAS,WAAW;gBAAE,QAAQ;YAAI;QAC/C;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,MAAM,OAAO,CAAC,KAAK,UAAU,KAAK,KAAK,UAAU,CAAC,MAAM,KAAK,GAAG;YACnE,OAAO,IAAI,SAAS,UAAU;gBAAE,QAAQ;YAAI;QAC9C;QAEA,KAAK,MAAM,QAAQ,KAAK,UAAU,CAAE;YAClC,IAAI,CAAC,KAAK,UAAU,EAAE;gBACpB,OAAO,IAAI,SAAS,qBAAqB;oBAAE,QAAQ;gBAAI;YACzD;YACA,IAAI,CAAC,KAAK,QAAQ,IAAI,KAAK,QAAQ,GAAG,GAAG;gBACvC,OAAO,IAAI,SAAS,aAAa;oBAAE,QAAQ;gBAAI;YACjD;QACF;QAEA,MAAM,cAAc,KAAK,UAAU,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,UAAU;QAEzD,MAAM,YAAY,MAAM,+GAAA,CAAA,SAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBAAE,IAAI;oBAAE,IAAI;gBAAY;YAAE;YACjC,QAAQ;gBAAE,IAAI;gBAAM,OAAO;gBAAM,aAAa;YAAK;QACrD;QAEA,IAAI,UAAU,MAAM,KAAK,YAAY,MAAM,EAAE;YAC3C,OAAO,IAAI,SAAS,gBAAgB;gBAAE,QAAQ;YAAI;QACpD;QAEA,IAAI,UAAU,IAAI,CAAC,CAAA,KAAM,GAAG,WAAW,KAAK,QAAQ;YAClD,OAAO,IAAI,SAAS,iBAAiB;gBAAE,QAAQ;YAAI;QACrD;QAEA,MAAM,WAAW,CAAC;QAClB,UAAU,OAAO,CAAC,CAAA;YAChB,QAAQ,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,KAAK;QAC5B;QAEA,MAAM,cAAc,KAAK,UAAU,CAAC,MAAM,CAAC,CAAC,KAAK;YAC/C,OAAO,MAAM,CAAC,QAAQ,CAAC,KAAK,UAAU,CAAC,IAAI,CAAC,IAAI,KAAK,QAAQ;QAC/D,GAAG;QAEH,MAAM,YAAW,MAAM,+GAAA,CAAA,SAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACzC,MAAM;gBACJ;gBACA;gBACA,OAAO;oBACL,QAAQ,KAAK,UAAU,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC;4BACnC,YAAY,KAAK,UAAU;4BAC3B,UAAU,KAAK,QAAQ;4BACvB,gBAAgB,KAAK,cAAc,IAAI;wBACzC,CAAC;gBACH;YACF;YACA,SAAS;gBACP,OAAO;YACT;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO,IAAI,SAAS,SAAS;YAAE,QAAQ;QAAI;IAC7C;AACF;AACA,MAAM,OAAO,CAAA,GAAA,mHAAA,CAAA,gBAAa,AAAD;AACzB,MAAM,QAAQ,CAAA,GAAA,oHAAA,CAAA,uBAAoB,AAAD;AACjC,KAAK,OAAO,CAAC,OAAO,KAAK,SAAS,CAAC,WAAW;IAAE,KAAK;AAAE,GAAG,CAAC;IACzD,IAAI,KAAK;QACP,QAAQ,KAAK,CAAC,gBAAgB;IAChC,OAAO;QACL,QAAQ,GAAG,CAAC;IACd;AACF","debugId":null}}]
}